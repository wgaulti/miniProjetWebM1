<!DOCTYPE html>
<html>
<head>
	<title>STAR FIGHT - Defeat the Siths</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="bootstrap.min.css"/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<link rel="stylesheet" href="general.css"/>
  	<link rel="shortcut icon" href="images/icon.jpg" type="image/x-icon" />
  	<script src="cookies.js"></script>
</head>

<body>

<header class="top-line">
		<nav class="main-menu top-menu">
			<a id="title"><img src="images/starfight.png" width=400 id="logo-sf"></a>
			<ul>
				<li><a href="contact.html">CONTACT</a></li>
			</ul>
		</nav>
</header>

<!-- Là où le personnage s'affiche en dynamique -->
<br><br><br>
<h1>CHOOSE YOUR CHARACTER</h1>
<div class="row">
	<article class="col-md-5"></article>
    <article class="col-md-2">
    	<div id=char-card></div>
    	<div class="button"></div>
	</article>
    <article class="col-md-5"></article>
</div>



<!-- Selection faction -->
<form>
        <select class="form-select form-select-custom" id="faction-select" name="faction-select" onchange="chooseFaction()">
            <option selected>-- PLEASE CHOOSE YOUR FACTION --</option>
		  	<option value="Jedis">JEDI</option>
		  	<option value="Siths">SITH</option>
        </select>
</form>
<br />
<!-- Selection du personnage -->
<div id="Perso"></div>

<!-- Affichage du score précedent obtenu -->
<div id="score"></div>

<script type="text/javascript">
// Appel ajax qui récupère les données du personnage dans le selectpicker et les mets dans une card bootstrap
	function madeAjaxCall(){
   		$.ajax({
    		type: "post",
    		url: "http://localhost:8080/showCharInfo",
    		cache: false,
    		data:'name=' + $("#char-select").val(),
    		success: function(response){
	     		$('#result').html("");
	     		var obj = response;
	     		$('#char-card').html("<div class=\"card\" style=\"width: 100%;\">"+
	  								"<img src=\"images/"+ obj.img + ".png\" class=\"card-img-top\" id=\"img-character\" width=500>"+
	  								"<div class=\"card-body\">"+
		    						"<h5 class=\"card-title\"><span id=\"nameValue\" class=\"bold\">"+ obj.name +"</span></h5>"+
								    "<p class=\"card-text\">"+
									"HP : <span id=\"HPValue\" class=\"bold\" >"+obj.hpMax+"</span><br>"+
									"ATTACK : <span id=\"attackValue\" class=\"bold\">"+obj.attack+"</span><br>"+
									"SPEED : <span id=\"dodgeValue\" class=\"bold\">"+obj.dodgePercent+"</span><br>"+
							  		"</div></div>");
    		},
	    	error: function(){
	     		alert('Error while request..');
    		}
		});
  }

function chooseFaction(){
		$.ajax({
		type: "post",
		url: "http://localhost:8080/showFaction",
		cache: false,
		data:'faction=' + $("#faction-select").val(),
		success: function(response){
     		$('#result').html("");
     		console.log(response);
     		const option = `<option selected>-- PLEASE CHOOSE A CHARACTER --</option>` + response.slice().map((el) => `<option value="${el}">${el}</option>`).join();
     		console.log(option);
     		var obj = response;
     		$('#Perso').html("<form action=\"/character\" method=\"post\"><select class=\"form-select form-select-custom\" id=\"char-select\" name=\"char-select\" onchange=\"madeAjaxCall()\">" + option + "</select><br><button type=\"submit\" class=\"btn btn-light btnValid\">LET'S GO</button></form>");
		},
    	error: function(){
     		alert('Error while request..');
		}
	});
}

		$.ajax({
		type: "post",
		url: "http://localhost:8080/score",
		cache: false,
		success: function(response){
     		console.log(response);
     		$('#score').html("<div><h1>LAST SCORE : </h1><h1 id='test'>"+ response + "</h1></div>");
		},
    	error: function(){
     		alert('Error while request..');
		}
	});

</script>

<footer id="footer">
    WILLIAM GAULTIER - THOMAS PRADEAU - M1 MIAGE
</footer>
</body>
</html>